<div class="container mx-auto px-4 py-8">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <div class="flex items-center gap-4">
      <button
        type="button"
        (click)="goToDashboard()"
        class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2"
        aria-label="Go back to dashboard"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M11 19l-7-7 7-7m8 14l-7-7 7-7"
          />
        </svg>
      </button>
      <h1 class="text-3xl font-bold text-gray-800">Tasks</h1>
    </div>
    <div class="flex gap-3">
      <button
        type="button"
        (click)="goToUpload()"
        class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 flex items-center gap-2"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"
          />
        </svg>
        Upload Document
      </button>
      <button
        type="button"
        (click)="openCreateModal()"
        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
      >
        Create Task
      </button>
    </div>
  </div>

  <!-- Filters -->
  <!-- <form [formGroup]="filterForm" class="bg-white rounded-lg shadow p-6 mb-6">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
      <div class="lg:col-span-2">
        <label for="search" class="block text-sm font-medium text-gray-700 mb-1">Search</label>
        <input
          type="text"
          id="search"
          formControlName="searchTerm"
          placeholder="Search tasks..."
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        />
      </div>

      <div>
        <label for="status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
        <select
          id="status"
          formControlName="status"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
          <option [value]="null">All Statuses</option>
          @for (status of statusList; track status.value) {
            <option [value]="status.value">{{ status.label }}</option>
          }
        </select>
      </div>

      <div>
        <label for="priority" class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
        <select
          id="priority"
          formControlName="priority"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
          <option [value]="null">All Priorities</option>
          @for (priority of priorityList; track priority.value) {
            <option [value]="priority.value">{{ priority.label }}</option>
          }
        </select>
      </div>

      <div>
        <label for="category" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
        <select
          id="category"
          formControlName="category"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
          <option [value]="null">All Categories</option>
          @for (category of categoryList; track category.value) {
            <option [value]="category.value">{{ category.label }}</option>
          }
        </select>
      </div>
    </div>

    <div class="flex justify-between items-center mt-4">
      <div class="w-48">
        <label for="sortBy" class="block text-sm font-medium text-gray-700 mb-1">Sort By</label>
        <select
          id="sortBy"
          formControlName="sortBy"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
          <option value="createdAt">Created Date</option>
          <option value="title">Title</option>
          <option value="dueDate">Due Date</option>
          <option value="priority">Priority</option>
          <option value="status">Status</option>
        </select>
      </div>

      <button
        type="button"
        (click)="clearFilters()"
        class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2"
      >
        Clear Filters
      </button>
    </div>
  </form> -->

  <!-- Tasks Grid -->
  @if (tasksStore.globalStore.isLoading()) {
    <div class="flex justify-center items-center py-12">
      <div class="text-gray-600">Loading tasks...</div>
    </div>
  } @else if (tasksStore.filteredTasks().length === 0) {
    <div class="bg-white rounded-lg shadow p-12 text-center">
      <p class="text-gray-500 text-lg">No tasks found</p>
      <p class="text-gray-400 mt-2">Create your first task to get started!</p>
    </div>
  } @else {
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      @for (task of tasksStore.filteredTasks(); track task.id) {
        <div class="bg-white rounded-lg shadow hover:shadow-lg transition-shadow">
          <div class="p-6">
            <!-- Header -->
            <div class="flex justify-between items-start mb-3">
              <h3 class="text-lg font-semibold text-gray-800 flex-1 mr-2">
                {{ task.title }}
              </h3>
              <span
                [class]="
                  'px-2 py-1 rounded-full text-xs font-medium ' + priorityColors[task.priority]
                "
              >
                {{ getPriorityLabel(task.priority) }}
              </span>
            </div>

            <!-- Description -->
            <p class="text-gray-600 text-sm mb-4 line-clamp-2">
              {{ task.description || 'No description' }}
            </p>

            <!-- Metadata -->
            <div class="space-y-2 mb-4">
              <div class="flex items-center text-sm text-gray-500">
                <span class="font-medium mr-2">Status:</span>
                <span
                  [class]="
                    'px-2 py-1 rounded-full text-xs font-medium ' + statusColors[task.status]
                  "
                >
                  {{ getStatusLabel(task.status) }}
                </span>
              </div>
              <div class="flex items-center text-sm text-gray-500">
                <span class="font-medium mr-2">Category:</span>
                <span>{{ getCategoryLabel(task.category) }}</span>
              </div>
              <div class="flex items-center text-sm text-gray-500">
                <span class="font-medium mr-2">Due Date:</span>
                <span>{{ formatDate(task.dueDate) }}</span>
              </div>
            </div>

            <!-- Actions -->
            <div class="flex gap-2 pt-4 border-t border-gray-100">
              <button
                type="button"
                (click)="viewTaskDetails(task.id)"
                class="flex-1 px-3 py-2 text-sm text-blue-600 bg-blue-50 rounded hover:bg-blue-100 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                View
              </button>
              <button
                type="button"
                (click)="openEditModal(task)"
                class="flex-1 px-3 py-2 text-sm text-green-600 bg-green-50 rounded hover:bg-green-100 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"
              >
                Edit
              </button>
              <button
                type="button"
                (click)="deleteTask(task.id, task.title)"
                class="flex-1 px-3 py-2 text-sm text-red-600 bg-red-50 rounded hover:bg-red-100 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500"
              >
                Delete
              </button>
            </div>
          </div>
        </div>
      }
    </div>
  }

  <!-- Task Form Modal -->
  <app-task-form
    [isOpen]="showCreateModal()"
    [taskId]="selectedTaskId()"
    [isEditMode]="isEditMode()"
    (formSubmitted)="closeModal()"
    (cancelled)="closeModal()"
    (closed)="closeModal()"
  />

  <!-- Delete Confirmation Modal -->
  <app-confirmation-modal
    [isOpen]="showDeleteConfirmation()"
    [isSubmitting]="isSubmitting()"
    title="Delete Task"
    [message]="getDeleteMessage()"
    confirmText="Delete"
    cancelText="Cancel"
    (confirmed)="confirmDelete()"
    (cancelled)="closeDeleteConfirmation()"
    (closed)="closeDeleteConfirmation()"
  />
</div>
